---
output: github_document
---

# Purpose

Purpose of this work folder.

Ideally store a minimum working example data set in data folder.

Add binary files in bin, and closed R functions in code. Human Readable settings files (e.g. csv) should be placed in settings/


```{r}

rm(list = ls()) # Clean your environment:
gc() # garbage collection - It can be useful to call gc after a large object has been removed, as this may prompt R to return memory to the operating system.
library(tidyverse)
library(RColorBrewer)
library(xtable)
library(lubridate)
library(huxtable)
library(knitr)
list.files('code/', full.names = T, recursive = T) %>% .[grepl('.R', .)] %>% as.list() %>% walk(~source(.))
covid_data <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 1/data/Covid/owid-covid-data.csv")
deaths_by_cause <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 1/data/Covid/Deaths_by_cause.csv")
description <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 1/data/Covid/covid_data_description.csv")
combined_data <- bind_rows(covid_data, description)
rm(combined_data)
```
\newpage
# Question 1: COVID
1.1 It might be interesting to look at vaccinations in Africa and the outbreak of the pandemic compared to other regions. For this question I could maybe also look at the deaths by cause database to see how COVID deaths differed to deaths before COVID.
```{r bar deaths}

total_deaths_per_continent <- df_cleaned %>% group_by(location) %>% mutate(total_deaths = total_deaths / 1000000) %>%
  summarise(total_deaths = sum(total_deaths)) 

rm(continent_covid)
rm(df_subset)
rm(bar_deaths)
rm(covid_updated)
rm(df_cleaned)
rm(g)
rm(plot_total_deaths_per_continent)

covid_cleaned <- covid_data %>%
  filter(location %in% c("Africa", "Asia", "North America", "Oceania", "South America", "Europe")) %>% mutate(total_deaths = ifelse(is.na(total_deaths), 0, total_deaths))

covid_cleaned <- covid_cleaned %>% mutate(total_cases = ifelse(is.na(total_cases), 0, total_cases))

bar_deaths <- plot_deaths(covid_cleaned)
bar_deaths
```
This first graph shows the total number of deaths (in millions) for each continent from COVID.

```{r}
library(lubridate)
library(dplyr)
rm(monthly_cases)
rm(covid_data_2020)

suppressWarnings(line_cases <- plot_cases(covid_cleaned))
line_cases
```
This graph shows how each continent experienced a growth in total cases (in millions) in 2020.

1.2 For this question, I'm going to use scatterplots to see correlations. I want to see how the United States, United Kingdom and Australia differed in their total deaths and life expectancy. These countries are all relatively similar
```{r LE table}
countrylist <- c("United States", "United Kingdom", "Australia")
country_covid <- covid_data %>% filter(location %in% countrylist)

mean_life_expectancy <- country_covid %>%
  group_by(location) %>%
  summarize(mean_life_expectancy = mean(life_expectancy, na.rm = TRUE))

table <- mean_life_expectancy %>%
  kable(format = "markdown")
table
```
This table shows that the life expectancy for each of these countries is relatively similar so they should be comparable.
```{r scatter plots}
LE_graph <- plot_deaths_LE(covid_data)
LE_graph

```
This shows that Australia has a much lower total deaths per million figure. I don'think this actaully makes sense.

I'm going to single out a few countries 
```{r}
top_countries <- covid_data %>%
  arrange(desc(human_development_index), desc(gdp_per_capita), desc(diabetes_prevalence)) %>%
  group_by(location) %>%
  slice_head(n = 1) 

```
Correlation between HDI and deaths and diabetes and deaths
```{r}
s_data <- covid_data %>% group_by(location) %>% slice(n()) %>% mutate(total_deaths = ifelse(is.na(total_deaths), 0, total_deaths)) %>% filter(!is.na(diabetes_prevalence), !is.na(gdp_per_capita))

highest_hdi_country <- covid_data$location[which.max(covid_data$human_development_index)]
lowest_hdi_country <- covid_data$location[which.min(covid_data$human_development_index)]
highest_gdp <- covid_data$location[which.max(covid_data$gdp_per_capita)]
Lowest_gdp <- covid_data$location[which.min(covid_data$gdp_per_capita)]

gdp_graph <- plot_comparison(covid_data)
gdp_graph
```
AGAIN
```{r}
df <- covid_data %>% group_by(location) %>% mutate(new_deaths = ifelse(is.na(new_deaths), 0, new_deaths)) %>%
        summarise(new_deaths = sum(new_deaths)) 

ggplot(df, aes(x = df$male_smokers, y = new_deaths, color = df$male_smokers)) +
  geom_point() +
  labs(title = "Scatterplot: Diabetes Prevalence vs Total Deaths",
       x = "Diabetes Prevalence",
       y = "Total Deaths") 
  
```

```{r}
covid_cleaned <- covid_cleaned %>% mutate(weekly_hosp_admissions = ifelse(is.na(weekly_hosp_admissions), 0, weekly_hosp_admissions)) %>% mutate(weekly_icu_admissions = ifelse(is.na(weekly_icu_admissions), 0, weekly_icu_admissions))

df <- covid_cleaned %>%
        mutate(date = as.Date(date)) %>%
        filter(year(date) == 2020) %>%
        mutate(month = month(date, label = TRUE))

monthly_admissions <- df %>%
        group_by(month) %>% 
        summarize(weekly_hosp_admissions = sum(weekly_hosp_admissions))

g <- monthly_admissions %>% ggplot() +
        geom_line(aes(x = month, y = weekly_hosp_admissions)) +
        labs(title = "Total Cases per Month and Location (2020)", x = "Month", y = "Total Deaths") +
        scale_color_discrete(name = "Location")
    g
```
\newpage
```{r loading data}
london_weather <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 2/data/London/london_weather.csv")
UK_detailed <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 2/data/London/UKMonthly_Detailed.csv")
london_weather$date <-as.character(london_weather$date)


UK_detailed$DATE <- as.Date(paste0(UK_detailed$DATE, "-01"), format = "%Y-%m-%d")

london_2000 <- london_weather %>% filter(date > 19991231)
#this only includes London weather info from 2000
```

I want to compare cloud cover and sunshine in London to see what they look like compared to each other.
```{r}
graph_cloud <- avg_london(london_2000)
graph_cloud
```
I'm using the next graph to show the rainfall for every day of the month of December in 2020.
```{r london rain}
rain_graph <- london_rain(london_weather)
rain_graph
```

There's a lot of data starting all the way from 1881 which I don't think is very necessary. The weather and climate has also changed a lot since then.
```{r}
UK_1980 <- UK_detailed %>% filter (DATE >= "1980-01-01")
temp_graph <- temp_bar(UK_1980)
temp_graph
```
Question 3
```{r load data}
coldplay_data <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 3/data/Coldplay_vs_Metallica/Coldplay.csv")
metallica_data <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 3/data/Coldplay_vs_Metallica/metallica.csv")
spotify_data <- read.csv("/Users/gracegrant/Documents/Postgrad/Masters/Data Science/Take home exam/Question 3/data/Coldplay_vs_Metallica/Broader_Spotify_Info.csv")
```

I'm going to do a scatter plot to see the correlation between energy and popularity and then, for each album of the bands, do a bar graph of their popularity and danceability.
```{r}
correlation_cp <- cor(coldplay_data[, c("popularity", "danceability", "energy", "instrumentalness", "liveness", "loudness")])
correlation_cp
correlation_m <- cor(metallica_data[, c("popularity", "danceability", "energy", "instrumentalness", "liveness", "loudness")])
correlation_m
#correlations show that danceability had the highest positive relationship with popularity for Coldplay and the second highest for Metallica so I'm using that metric

scatter_cp <- scatter_coldplay(coldplay_data)
scatter_cp
```
```{r}
scatter_m <- scatter_metallica(metallica_data)
scatter_m
```

```{r}
top_10_danceability_songs <- spotify_data %>% select(c(name, artist, danceability)) %>% 
  arrange(desc(danceability)) %>%
  head(10)
top_10_table <- as_huxtable(top_10_danceability_songs)
top_10_table
```
```{r}
studio_coldplay <- coldplay_data %>% filter(!grepl("live|Live", name)) %>% filter(!grepl("live|Live", album_name))
studio_metallica <- metallica_data %>% filter(!grepl("live|Live", name)) %>% filter(!grepl("live|Live", album))
```

```{r}
pop_g_cp <- popularity_coldplay(studio_coldplay)
pop_g_cp
```
```{r}
pop_g_m <- popularity_metallica(studio_metallica)
pop_g_m
```











